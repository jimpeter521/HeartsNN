FROM heartsnn/build:latest

RUN apt-get -y install libuv1-dev

COPY . /heartsnn
WORKDIR /heartsnn

ENV PATH="/heartsnn/devbin:${PATH}"
CMD /heartsnn/devbin/bld release all_tests

RUN cp /heartsnn/builds/release/apps/analyze /usr/local/bin/
RUN cp /heartsnn/builds/release/apps/deal /usr/local/bin/
RUN cp /heartsnn/builds/release/apps/hearts /usr/local/bin/
RUN cp /heartsnn/builds/release/apps/tournament /usr/local/bin/
RUN cp /heartsnn/builds/release/apps/validate /usr/local/bin/
RUN cp /heartsnn/builds/release/websockets-cards/webSocketServer /usr/local/bin/

WORKDIR dlib
RUN python3 setup.py install
WORKDIR /heartsnn

# RUN rm -rf /heartsnn/builds
